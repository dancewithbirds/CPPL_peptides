<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peptide Inventory | Lab Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-50 min-h-screen">

    <nav class="bg-blue-600 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold tracking-tight">LabInventory</h1>
            <span class="text-sm bg-blue-700 px-3 py-1 rounded-full">Peptide DB Mode</span>
        </div>
    </nav>

    <div class="container mx-auto p-6">
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-lg font-semibold mb-4 text-gray-700">Search</h2>
            <div class="flex gap-2">
                <input type="text" id="searchInput" 
                    placeholder="펩타이드 서열 또는 이름 입력..." 
                    class="flex-1 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button onclick="searchPeptide()" 
                    class="bg-blue-600 text-white px-6 py-3 rounded-md font-medium hover:bg-blue-700 transition">
                    Find
                </button>
            </div>
            <p id="statusMessage" class="mt-2 text-sm text-gray-500 italic"></p>
        </div>

        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <table class="w-full text-left border-collapse">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="p-4 border-b font-semibold text-gray-600">ID</th>
                        <th class="p-4 border-b font-semibold text-gray-600">Name</th>
                        <th class="p-4 border-b font-semibold text-gray-600">Sequence</th>
                        <th class="p-4 border-b font-semibold text-gray-600">MW</th>
                        <th class="p-4 border-b font-semibold text-gray-600">Comments</th>
                    </tr>
                </thead>
                <tbody id="resultBody">
                    <tr>
                        <td colspan="5" class="p-8 text-center text-gray-400">검색어를 입력하고 버튼을 눌러주세요.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // 1. 본인의 Supabase 정보로 수정하세요
        const SUPABASE_URL = 'https://nhlrilhujabietrwtmtb.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_FtGTivKS0MIzdwoqUA-xig_OYgSND9I';
        
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function searchPeptide() {
            const query = document.getElementById('searchInput').value;
            const status = document.getElementById('statusMessage');
            const resultBody = document.getElementById('resultBody');

            status.innerText = "데이터를 찾는 중입니다...";
            resultBody.innerHTML = ''; // 이전 결과 초기화

            try {
                // 2. DB 쿼리 실행 (이름 혹은 서열에 검색어가 포함된 경우)
                // .or()를 사용하여 이름(name)이나 서열(sequence) 둘 중 하나라도 맞으면 가져옵니다.
                const { data, error } = await supabaseClient
                    .from('Peptides_under10mer') // 테이블 이름 확인 필수
                    .select('*')
                    .or(`name.ilike.%${query}%,sequence.ilike.%${query}%`);

                if (error) throw error;

                if (data.length === 0) {
                    resultBody.innerHTML = '<tr><td colspan="5" class="p-8 text-center text-gray-500">일치하는 항목이 없습니다.</td></tr>';
                    status.innerText = "검색 완료 (0건)";
                    return;
                }

                // 3. 데이터를 표에 렌더링
                data.forEach(item => {
                    const row = `
                        <tr class="hover:bg-gray-50 border-b transition">
                            <td class="p-4 text-medium text-gray-800">${item.id}</td>
                            <td class="p-4 text-medium text-gray-800">${item.name || 'N/A'}</td>
                            <td class="p-4 text-medium text-red-800">${item.sequence}</td>
                            <td class="p-4 text-medium text-gray-800">${item.mw || '-'}</td>
                            <td class="p-4">
                                <span class="bg-green-100 text-gray-800 text-xs px-2 py-1 rounded">
                                    ${item.comments || '보관소 미정'}
                                </span>
                            </td>
                        </tr>
                    `;
                    resultBody.innerHTML += row;
                });

                status.innerText = `총 ${data.length}개의 결과를 찾았습니다.`;

            } catch (err) {
                console.error("Error:", err);
                status.innerText = "오류가 발생했습니다: " + err.message;
                alert("데이터를 불러오지 못했습니다. 검색어를 확인하세요.");
            }
        }
    </script>
</body>
</html>
